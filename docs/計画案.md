# 計画案

## 概要

このプロジェクトは、小説執筆を補助するためのObsidianプラグイン「Novelaid Tools」を開発する。
Gemini APIを活用し、執筆の効率化と質の向上を目指す。

## 機能一覧

### 生成AIを必要とする機能

- [ ] 1. **キャラクター設定支援機能**
    - [ ] 1.1. キャラクターの基本情報（名前、年齢、性別など）を入力すると、性格や背景を自動生成する。
- [ ] 2. **プロット作成支援機能**
    - [ ] 2.1. 物語のテーマやジャンル、登場人物などを入力すると、プロットの骨子を提案する。
    - [ ] 2.2. 三幕構成や起承転結などのテンプレートに沿ったプロット生成。
- [x] 3. **文章推敲・校正機能（AI活用）**
    - [x] 3.1. 誤字脱字のチェック（AIによる校正機能を実装済み）
    - [x] 3.2. 表現の揺らぎを指摘・修正案を提示（AIによる校正・レビュー機能を実装済み）
    - [ ] 3.3. 文章をより豊かにするための類語提案
- [x] 4. **チャット形式での相談機能**
    - [x] 4.1. 執筆に行き詰まった際に、AIに相談できるチャットUIを提供（ChatViewの基礎実装済み）
- [ ] 5. **AIによるタイトル・あらすじ生成**
    - [ ] 5.1. 作品タイトルやあらすじの自動提案


### 生成AIを必要としない機能

- [ ] 6. **ルビ振り機能**
    - [ ] 6.1. 漢字に対して自動でルビを振る（Markdown記法対応済み）
- [ ] 7. **プロジェクト管理・章立て支援**
    - [ ] 7.1. 章・話ごとの構成管理、並び替え
    - [ ] 7.2. 執筆メモやTODOの管理
- [ ] 8. **用語集・世界観設定支援**
    - [ ] 8.1. 固有名詞や設定の一元管理
    - [ ] 8.2. 設定の自動抽出・整理
- [ ] 9. **小説分析機能**
    - [ ] 9.1. **文体・表現の分析**
        - [ ] 9.1.1. 品詞の割合分析（名詞、動詞、形容詞など）
        - [ ] 9.1.2. 文の長さの分布分析
    - [ ] 9.2. **登場人物の分析**
        - [ ] 9.2.1. 登場人物の出現頻度・相関分析

### 設定・その他

- [ ] 10. **Gemini AIモデル選択機能**
    - [ ] 10.1. 設定画面で、使用するGeminiのモデルを選択可能にする。（例: `gemini-2.5-flash`, `gemini-2.5-pro`）
    - [ ] 10.2. プルダウンにないモデル名を任意で入力できるカスタムオプションを追加する。
- [ ] 11. **AI接続テスト機能**
    - [ ] 11.1. 設定画面に、入力されたAPIキーと選択されたモデルでGemini APIへ接続テストを行うボタンを設置する。
    - [ ] 11.2. 接続結果（成功・失敗）をユーザーに通知する。

### 追加しない機能（記録・管理系）

以下の機能は本プラグインの主目的（創作支援・AI活用）から外れるため、現時点では追加しません。ユーザーの執筆活動や生活リズムの管理は他ツールやObsidian標準機能で代替可能と判断しています。

- [ ] A. **執筆進捗管理機能**
    - [ ] A.1. 目標文字数や進捗グラフの表示
    - [ ] A.2. 日ごとの執筆記録・統計
- [ ] B. **執筆リズム支援（タイマー・ポモドーロ）**
    - [ ] B.1. 集中タイマーや休憩通知


## 実装状況

- 2025/07/20: プロジェクト初期設定完了。計画案作成。
- 2025/07/20: 文章推敲・校正機能、ルビ振り機能、チャットUIの基礎実装完了。
- 2025/08/02: コンテキスト取得処理のリファクタリングに着手。
- 2025/08/03: Gemini AIモデルの選択機能の計画・設計に着手。
- 2025/08/03: AI接続テスト機能の計画に着手。

## 今後の課題・TODO

- **AI接続テスト機能の実装**
    - **目的:** ユーザーがAPIキーやモデル設定の正しさをその場で確認できるようにし、設定ミスによるトラブルを減らす。
    - **計画:**
        - `src/services/geminiService.ts` に接続テスト用の軽量な関数を追加する。
        - `src/novelaidToolsSettingsTab.ts` にテスト実行ボタンと結果通知のロジックを実装する。
- **Gemini AIモデル選択機能の実装**
    - **目的:** ユーザーが利用シーンやコストに応じて、使用するGeminiモデルを柔軟に切り替えられるようにする。
    - **計画:**
        - `src/novelaidToolsSettings.ts` にモデル設定（`geminiModel`）を追加する。
        - `src/novelaidToolsSettingsTab.ts` に、ドロップダウン選択と任意入力を組み合わせたUIを実装する。
        - `src/services/geminiService.ts` が設定値を参照するように修正する。
- **コンテキスト取得処理のリファクタリング**
    - **目的:** 生成AIに与えるコンテキスト（アクティブなファイル、フォルダ内のファイル一覧など）を取得するロジックを、再利用可能なサービスとして独立させる。
    - **計画:**
        - `src/services/obsidianContextService.ts` を新設する。
        - ObsidianのAPIを直接利用している箇所を新サービスに集約し、各機能（ChatView, geminiService等）は新サービスを経由してコンテキスト情報を取得するように修正する。
        - これにより、コードの再利用性を高め、将来的な機能拡張（例: ファイル横断的な情報提供）を容易にする。
- 校正機能のUIデザイン改善
    - 現状は「校正前」「校正後」「理由」が横並び（3列）で表示されているが、縦長ペインでは視認性が悪い。
    - 「校正前」「校正後」「理由」を縦方向に並べて表示するレイアウトを検討する。
    - 校正前・校正後の差分や理由が一目で分かるよう、色分けや強調表示などデザイン面も改善する。


## 開発マイルストーン

- **フェーズ1（～2025/08）: 基本機能の実装とリファクタリング**
    - [x] 3. 文章推敲・校正機能
    - [x] 4. チャット形式での相談機能
    - [x] 6. ルビ振り機能
    - [ ] コンテキスト取得処理のリファクタリング
    - [ ] 10. Gemini AIモデル選択機能
    - [ ] 11. AI接続テスト機能
- **フェーズ2（～2025/09）: 支援機能の拡充**
    - [ ] 1. キャラクター設定支援機能
    - [ ] 2. プロット作成支援機能
- **フェーズ3（～2025/10）: 分析・管理機能の追加**
    - [ ] 9. 小説分析機能
    - [ ] 7. プロジェクト管理・章立て支援
- **フェーズ4（リリース後）: 改善・高度化**
    - [ ] ユーザーフィードバックに基づく改善
    - [ ] AIモデルのアップデート対応
    - [ ] パフォーマンスチューニング
